<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix Look-alike</title>
    <style>
     .suggestions-section {
                overflow-x: auto;
                white-space: nowrap;
            }
            .suggestions-posts {
                display: inline-block;
                margin-right: 10px; /* Adjust spacing between posts as needed */
            }
    .profile-info {
        display: flex;
        align-items: center;
    }
    
    /* Style the container for profile picture and name */
    .profile-picture-container {
        display: flex;
        align-items: center;
    }
    
    /* Style the profile picture */
    .profile-picture {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    /* Style the user name */
    .user-name {
       /* Styles for the profile info container */
    .profile-info {
        display: flex;
        align-items: center;
    }
    
    /* Style the container for profile picture and name */
    .profile-picture-container {
        display: flex;
        align-items: center;
    }
    
    /* Style the profile picture */
    /* Style the profile picture */
    .profile-picture {
        width: 120px; /* Set the width to your desired size */
        height: 120px; /* Set the height to your desired size */
        border-radius: 50%;
        margin-right: 20px;
        object-fit: cover; /* Maintain aspect ratio and cover the entire space */
        border: 3px solid #fff; /* Add a border to make it more appealing */
    }
    
    
    /* Style the user name */
    .user-name {
        font-size: 16px;
        font-weight: bold;
        text-decoration: none;
        color: #333; /* You can adjust the color as needed */
    }
    
        text-decoration: none;
        color: #333; /* You can adjust the color as needed */
    }
    
    
    .user-link {
        text-decoration: none; /* Remove the underline from the link */
        color: inherit; /* Inherit the text color from the parent element */
    }
    
    .user-link:hover .user-name {
        text-decoration: underline; /* Add underline on hover */
    }
    
    .popup {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 2;
        justify-content: center;
        align-items: center;
    }
    
    .popup-content {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    }
    
    .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        cursor: pointer;
    }
    
    /* Style your search results container here */
    #searchResults {
        /* Add your styles for the search results */
        background-color: #0e5aee;
    }
    /* Style the search bar container and button */
    .search-bar {
        display: flex;
        align-items: center;
        overflow-y: hidden; /* Prevent vertical scrolling */
    
    
        position: fixed;
    }
    
    .search-bar input {
        flex-grow: 1;
        padding: 8px;
        border: none;
        border-radius: 25px;
        margin-right: 10px;
        font-size: 14px;
    }
    
    .search-bar button {
        background-color:white;
        color: #fff;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        padding: 8px 20px;
    }
    
    #searchButton:hover {
        background-color: #555;
    }
    
    
    /* Vertical scrolling for allUsersContainer */
    .horizontal-scroll-container {
        overflow-x: auto; /* Enable vertical scrolling */
        max-height: 300px; /* Set the max height to control the scrollable area */
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    /* Global styles */
    body {
        font-family: Arial, sans-serif;
        background-color:whites;
        margin: 0;
        padding: 0;
        color: #333;
    }
    /* Add this style to make the top-nav fixed */
    .top-nav {
        position: fixed;
        border: 10px;
        top: 0;
        left: 0;
        right: 0;
        background-color:black;/* Set the background color as needed */
        color: #fff; /* Set the text color as needed */
        display: flex;
        justify-content: space-between;
        align-items: center;
        
        z-index: 2; /* Set an appropriate z-index to ensure it's above other content */
        transition: background-color 0.3s ease; /* Add a smooth transition effect for background color */
    }
    
     /* Style for the search bar container and button */
     .search-bar {
        display: flex;
        align-items: center;
        overflow-y: hidden; /* Prevent vertical scrolling */
        background-color: #fff; /* White background color */
        border: 1px solid #ccc; /* Add a subtle border */
        border-radius: 25px; /* Rounded corners */
        padding: 5px; /* Adjust padding as needed */
    }

    .search-bar input {
        flex-grow: 1;
        padding: 8px;
        border: none;
        font-size: 16px; /* Increase font size */
    }

    .search-bar button {
        background-color: #e50914; /* Netflix red button color */
        color: #fff; /* White text color */
        border: none;
        border-radius: 25px; /* Rounded corners */
        cursor: pointer;
        font-size: 16px; /* Increase font size */
        padding: 8px 20px; /* Adjust padding as needed */
    }

    #searchButton:hover {
        background-color: #b2070d; /* Darker red on hover */
    }
    
    
    /* Main content container */
    .content {
        position: fixed;
        max-width: 50px;
        margin: 20px auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }
    
    .left-sidebar {
        flex: 1;
        padding-right: 20px;
        border-right: 1px solid #ccc;
        display: none; /* Hide the left-sidebar by default */
    }
    
    
    .left-sidebar h2 {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .left-sidebar .user-card {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        cursor: pointer;
    }
    
    .left-sidebar .user-card img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .left-sidebar .user-card span {
        font-size: 16px;
    }
    
    /* Main content */
    .main-content {
        flex: 2;
    }
    
    /* Posts */
    .post {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 10px;
        background-color:white;
        border-radius: 10px;
    /* Original box-shadow */
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    
    /* Darker and cooler box-shadow */
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3);
    
    }
    
    .post .post-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    /* Update profile picture styles */
    .post .post-header img {
        width: 22px; /* Adjust the size as needed */
        height: 22px; /* Adjust the size as needed */
        border-radius: 50%;
        margin-right: 5px;
    }
    
    /* Update username styles */
    .post .post-header h3 {
        font-size: 16px; /* Adjust the font size as needed */
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .post .post-content {
        font-size: 16px;
        margin-bottom: 5px;
    }
    
    .post .post-image {
        max-width: 110%;
        margin-bottom: 10px;
    }
    
    .post .post-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .post .post-actions button {
        padding: 5px 10px;
        background-color: #cc0000;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .post .post-actions button:hover {
        background-color: #0e5aee;
    }
    
    /* Style the like and comment buttons */
    .like-button, .comment-button {
        background-color: #f0f0f0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        padding: 5px 10px;
        margin-right: 10px;
        transition: background-color 0.3s ease;
    }
    
    .like-button:hover, .comment-button:hover {
        background-color: #e0e0e0;
    }
    
    /* Style the likers and comments containers */
    .likers, .comments {
        margin-top: 10px;
        max-height: 150px; /* Set a maximum height for the containers */
        overflow-y: auto; /* Enable vertical scrolling */
    }
    
    /* Style the individual liker/comment elements */
    .liker-element, .comment {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .liker-element img, .comment img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .comment-content {
        flex: 1;
        padding: 10px;
        background-color: #f2f3f5;
        border-radius: 10px;
    }
    
    .comment-username {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .comment-text {
        margin: 0;
    }
    
    
    
    
    
    /* Add this CSS to style the profile picture and username */
    .user-info {
        display: flex;
        align-items: center;
    }
    
    .user-info img.profile-picture {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    .user-info a.user-name {
        font-size: 16px;
        font-weight: bold;
        text-decoration: none;
        color: #333; /* You can adjust the color as needed */
    }
    /* Style the like and comment buttons */
    .like-button, .comment-button {
        background-color: #f0f0f0;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        padding: 5px 10px;
        margin-right: 10px;
        transition: background-color 0.3s ease;
    }
    
    .like-button:hover, .comment-button:hover {
        background-color: #e0e0e0;
    }
    
    /* Style the likers and comments containers */
    .likers, .comments {
        margin-top: 10px;
        max-height: 150px; /* Set a maximum height for the containers */
        overflow-y: auto; /* Enable vertical scrolling */
    }
    
    /* Style the individual liker/comment elements */
    .liker-element, .comment {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .liker-element img, .comment img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
    }
    
    
    .comment-content {
        flex: 1;
        padding: 10px;
        background-color: #f2f3f5;
        border-radius: 10px;
    }
    
    .comment-username {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .comment-text {
        margin: 0;
    }
    /* Style the like and comment buttons like Instagram */
    .like-button, .comment-button {
        background-color: green;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        padding: 5px 10px;
        margin-right: 10px;
        transition: background-color 0.3s ease, color 0.3s ease;
        color: #262626; /* Text color */
    }
    
    .like-button:hover, .comment-button:hover {
        background-color: rgba(0, 0, 0, 0.07); /* Light gray background on hover */
        color: #333; /* Darker text color on hover */
    }
    
    .container {
                max-width: 1000px;
                max-height: 1000px;
                margin: 0 auto;
                padding: 20px;
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
            /* Add this CSS to your existing styles or in a separate CSS file */
    
    .red-crushies {
        color: red; /* Set the color to red */
        /* Add any other styles you want for the crushies button here */
    }
    /* Add this CSS to style the view comments and view likers buttons */
    .view-comments-button,
    .view-likers-button {
        color: #555; /* Set the color for the icons */
        background-color: transparent; /* Make the buttons transparent */
        border: none; /* Remove border */
        cursor: pointer; /* Add a pointer cursor on hover */
        padding: 0; /* Remove padding */
        margin-right: 10px; /* Adjust spacing as needed */
    }
    
    /* Add this CSS code to style the profile picture */
    .profile-picture {
        width: 40px; /* Adjust the width to your preference */
        height: 40px; /* Adjust the height to your preference */
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer; /* Add cursor style to indicate interactivity */
        transition: transform 0.2s; /* Add a smooth hover effect */
    }
    
    .profile-picture:hover {
        transform: scale(1.1); /* Scale up the picture slightly on hover */
    }

        
            .genre-buttons button {
                background-color: #ff0000;
                color: #fff;
                padding: 10px 20px;
                font-size: 16px;
                border: none;
                cursor: pointer;
                margin: 5px;
                border-radius: 10px;
            }
        
            .genre-buttons button:hover {
                background-color: #cc0000;
            }
        
            .video-list {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 20px;
                margin-top: 20px;
            }
   /* Define a class for the video container */
/* Your existing CSS styles here */

/* Style for the video card */
.video-card {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

/* Style for the video player in the video card */
.video-card video {
    max-width: 100%;
    height: auto;
}

/* Style for the caption and description container */
.caption-description-container {
    display: flex;
    flex-direction: column;
    padding: 10px;
    margin-top: 10px;
}

/* Style for the caption text */
.caption-description-container .caption-text {
    color: #333;
    font-size: 14px;
    margin-bottom: 10px;
}

/* Style for the description text */
.caption-description-container .description-text {
    color: #606060;
    font-size: 12px;
    line-height: 1.4;
}

/* Style for the description button */
.caption-description-container .description-button {
    background: transparent;
    border: none;
    color: #606060;
    font-size: 14px;
    cursor: pointer;
}

            .video-card:hover video {
                opacity: 1;
            }
        
            .video-card:hover {
                transform: scale(1.03);
            }
            .like-button {
                background-color: #e50914;
                color: #fff;
                padding: 5px 10px;
                font-size: 16px;
                border: none;
                cursor: pointer;
                display: block;
                margin: 10px auto;
                border-radius: 10px;
            }
        
            .like-button:hover {
                background-color: #ff3d32;
            }
        
            .like-count {
                font-size: 16px;
                margin-top: 5px;
                text-align: center;
            }
        
            .caption-text {
                font-size: 16px;
                margin-top: 5px;
                text-align: center;
            }
        
            /* Media query for desktop screens */
            @media (min-width: 1024px) {
                .video-card {
                    width: calc(33.33% - 20px); /* Three videos per row on desktop */
                }
            }

            @media (min-width: 1024px) {
            .video-card {
                height: 300px; /* Adjust the height as needed */
            }
             }

             
            .moving-text {
            position: absolute;
            top: 0;
            left: 0;
            animation: moveText 10s linear infinite;
        }

        @keyframes moveText {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(100%);
            }
        }

        .video-element {
            height: 400px; /* Increase the height as needed */
        }
        .hamburger {
            cursor: pointer;
            font-size: 24px;
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 2; /* Ensure the hamburger appears above the menu */
        }
        aside {
            width: 200px; /* Adjust the width to make it slightly smaller */
            height: 100%;
            position: fixed;
            top: 40px; /* Adjust the top value to position it below the hamburger */
            left: -200px; /* Start with the menu hidden */
            background-color: #333;
            overflow-x: hidden;
            transition: 0.5s;
        }
        aside a {
            padding: 16px 16px;
            text-align: left;
            text-decoration: none;
            font-size: 20px;
            color: white;
            display: block;
        }
        aside a:hover {
            color: #f1f1f1;
        }

        @media screen and (max-width: 768px) {
            .hamburger {
                display: block;
                z-index: 3; /* Ensure the hamburger is on top */
            }
        }

        @media screen and (min-width: 769px) {
            .hamburger {
                display: none;
            }
            aside {
                width: 200px; /* Adjust the width to make it slightly smaller */
                left: 0;
            }
        }
    </style>
    
</head>
<body>

    <header>
        <!-- Your header content... -->
        <div class="hamburger" onclick="toggleMenu()">&#9776;</div>
    </header>


    <div class="container">
        <h1>SOSHOBIRD</h1>
       

<!-- Add this input field for searching captions -->
 <input type="text" id="searchInput" placeholder="Search Captions">
        <button onclick="searchCaptions()" id="searchButton">Search</button>
        <h1 id="username"></h1>


     <!-- Add genre buttons -->
     <div class="genre-buttons">
        <button onclick="filterMovies('action')">Action</button>
        <button onclick="filterMovies('drama')">Drama</button>
        <button onclick="filterMovies('folk')">Folk</button>
        <button onclick="filterMovies('horror')">Horror</button>
        <button onclick="filterMovies('comedy')">Comedy</button>
    </div>

        <input type="file" id="movieInput" accept="video/*" required>
        <input type="text" id="captionInput" placeholder="Enter Captions (optional)">
        <input type="text" id="descriptionInput" placeholder="Enter Description (optional)">
        <button onclick="uploadMovie()" class="upload-button">Upload</button>


         <!-- Add a div element to display upload progress -->
         <div id="uploadProgress"></div>
        <h2></h2>

        <div class="video-list" id="movieList"></div>
    </div>
    
    
    <aside>
        <a href="#">Home</a>
        <a href="#">History</a>
        <a href="#">Notifications</a>
        <a href="#">Settings</a>
    </aside>



    <!-- Include Firebase JavaScript SDK here -->
    <!-- Replace with your Firebase configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-storage.js"></script>
    <script>

    // Initialize Firebase with your configuration
    var firebaseConfig = {
        apiKey: "AIzaSyAVeabVGSO5Ru1u5MBccbZ03Onpul5_16Y",
  authDomain: "nexyket.firebaseapp.com",
  databaseURL: "https://nexyket-default-rtdb.firebaseio.com",
  projectId: "nexyket",
  storageBucket: "nexyket.appspot.com",
  messagingSenderId: "398223201089",
  appId: "1:398223201089:web:233e87df3e2755c80607c0",
  measurementId: "G-TE9RNY1NTL"
    };

    firebase.initializeApp(firebaseConfig);

    const storage = firebase.storage();
        const database = firebase.database();
        // Add this JavaScript code
        let menuOpen = false;
        const aside = document.querySelector('aside');
        const hamburger = document.querySelector('.hamburger');

        function toggleMenu() {
            menuOpen = !menuOpen;
            aside.style.left = menuOpen ? '0' : '-250px';
        }

        document.addEventListener('DOMContentLoaded', () => {
            const movieList = document.getElementById('movieList');
            const videoContainer = document.getElementsByClassName('video-card');
    let currentVideoIndex = 0;

            let currentUser = null;
            let currentPlayingVideo = null; // Store the currently playing video element

            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    // Fetch and display the user's name from the database
                    const userProfileRef = database.ref(`userProfile/${currentUser.uid}`);
                    userProfileRef.once('value', snapshot => {
                        const userProfile = snapshot.val();
                        if (userProfile && userProfile.name) {
                            const usernameElement = document.getElementById('username');
                            usernameElement.innerText = userProfile.name;
                        }
                    });
                } else {
                    currentUser = null;
                }
                loadMovies();
            });
     // Function to pause other videos when one starts playing
     function pauseOtherVideos(currentVideo) {
                const videoElements = document.querySelectorAll('video');
                videoElements.forEach(video => {
                    if (video !== currentVideo) {
                        video.pause();
                    }
                });
            }


            function displayNextVideo() {
        if (currentVideoIndex < videoContainer.length) {
            // Get the next video source and description
            const nextVideo = videoContainer[currentVideoIndex];
            const videoElement = nextVideo.querySelector('video');
            const videoSrc = videoElement.src;
            const videoDescription = videoElement.nextElementSibling.innerText;

            // Display the next video and description in the overlay
            const largeVideo = document.getElementById('largeVideo');
            const videoDescriptionElement = document.getElementById('videoDescription');
            largeVideo.src = videoSrc;
            videoDescriptionElement.innerText = videoDescription;

            currentVideoIndex++;
        }
    }




        function loadMovies() {
            // Fetch and display movies from the Firebase Realtime Database
            const moviesRef = database.ref('movies');

            moviesRef.once('value', snapshot => {
                movieList.innerHTML = '';
                snapshot.forEach(movieSnapshot => {
                    const movie = movieSnapshot.val();
                    const movieId = movieSnapshot.key;
                    const videoContainer = document.createElement('div');
                    videoContainer.classList.add('video-card');
                    const movieElement = document.createElement('video');
                    movieElement.src = movie.url;
                    movieElement.controls = true;
                    videoContainer.appendChild(movieElement);



                      // Inside your loadMovies function, after creating videoContainer
                      const captionText = document.createElement('div');
                        captionText.classList.add('caption-text');
                        captionText.innerText = `Captions: ${movie.captions || 'No captions available'}`;
                        videoContainer.appendChild(captionText);

                        // Add an event listener to track when the video starts playing
                        movieElement.addEventListener('play', () => {
                            // Update the caption text and style it in red
                            captionText.innerText = `Captions: ${movie.captions || 'No captions available'}`;
                            captionText.style.color = 'red';
                        });

                        // Add an event listener to track when the video pauses
                        movieElement.addEventListener('pause', () => {
                            // Reset the caption text to its original style
                            captionText.innerText = `Captions: ${movie.captions || 'No captions available'}`;
                            captionText.style.color = 'white'; // Set it back to black

 });

                        // Add an event listener to play the video and pause others
                        movieElement.addEventListener('play', () => {
                            pauseOtherVideos(movieElement);
                        });

 // Add an event listener to move to the next video when one finishes
 movieElement.addEventListener('ended', () => {
                            // Find the next sibling video and play it
                            const nextVideoContainer = videoContainer.nextElementSibling;
                            if (nextVideoContainer) {
                                const nextVideoElement = nextVideoContainer.querySelector('video');
                                if (nextVideoElement) {
                                    nextVideoElement.play();
                                }
                            }
                        });


                    // Create a div for description
                    const descriptionText = document.createElement('div');
                    descriptionText.classList.add('description-text');
                    descriptionText.innerText = `Description: ${movie.description || 'No description available'}`;
                    descriptionText.style.display = 'none'; // Hide by default
                    videoContainer.appendChild(descriptionText);

                    // Create a button to toggle the description visibility
                    const descriptionButton = document.createElement('button');
                    descriptionButton.classList.add('description-button');
                    descriptionButton.innerText = 'Description';
                    descriptionButton.addEventListener('click', () => {
                        if (descriptionText.style.display === 'none') {
                            descriptionText.style.display = 'block';
                        } else {
                            descriptionText.style.display = 'none';
                        }
                    });
                    videoContainer.appendChild(descriptionButton);



// Inside your loadMovies function, after creating videoContainer



                    // Create div to display like count
                    const likeCount = document.createElement('div');
                    likeCount.classList.add('like-count');
                    likeCount.innerText = 'Likes: 0'; // Initialize with 0 likes

                    // Create div to display captions
    
                    captionText.classList.add('caption-text');
                    captionText.innerText = `Captions: ${movie.captions || 'No captions available'}`;

                    // Create like button
                    const likeButton = document.createElement('button');
                    likeButton.classList.add('like-button');
                    likeButton.innerText = 'Like';

                    // Event listener for like button
                    likeButton.addEventListener('click', () => {
                        if (currentUser) {
                            // Check if the user has already liked this movie
                            const userLikesRef = database.ref(`users/${currentUser.uid}/likes`);
                            userLikesRef.once('value', userLikesSnapshot => {
                                if (!userLikesSnapshot.hasChild(movieId)) {
                                    // User has not liked this movie, allow them to like it
                                    const movieLikesRef = database.ref(`movies/${movieId}/likes`);
                                    movieLikesRef.transaction(currentLikes => {
                                        // If no likes exist, start with 1 like; otherwise, increment by 1
                                        return (currentLikes || 0) + 1;
                                    }).then(() => {
                                        // Update the displayed like count
                                        movieLikesRef.once('value', snapshot => {
                                            const updatedLikes = snapshot.val();
                                            likeCount.innerText = `Likes: ${updatedLikes}`;
                                        });

                                        // Record the user's like in the user's likes list
                                        userLikesRef.child(movieId).set(true);
                                    });
                                }
                            });
                        } else {
                            // User is not authenticated, handle accordingly (e.g., show a message or prompt for login)
                            alert('Please log in to like the movie.');
                        }


                        
                        
                    });




                    videoContainer.appendChild(likeCount);
                    videoContainer.appendChild(captionText);
                    videoContainer.appendChild(likeButton);
                    movieList.appendChild(videoContainer);

                    // Fetch and display the initial like count from the database
                    const movieLikesRef = database.ref(`movies/${movieId}/likes`);
                    movieLikesRef.on('value', snapshot => {
                        const updatedLikes = snapshot.val();
                        likeCount.innerText = `Likes: ${updatedLikes}`;


                        
                    });
                });
            });
        }
    });

           
        

    function updateUploadProgress(snapshot) {
    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
    console.log(`Upload progress: ${progress}%`);
    // You can display the progress in a div or any other element
    // For example, update an element with the ID 'uploadProgress'
    const uploadProgress = document.getElementById('uploadProgress');
    uploadProgress.innerText = `Upload progress: ${progress.toFixed(2)}%`;
}


function uploadMovie() {
    const movieInput = document.getElementById('movieInput');
    const captionInput = document.getElementById('captionInput');
    const descriptionInput = document.getElementById('descriptionInput');
    const file = movieInput.files[0];

    if (!file) {
        alert('Please select a video file to upload.');
        return;
    }

    const storageRef = storage.ref().child(`movies/${file.name}`);
    const metadata = {
        contentType: file.type,
    };

    // Upload the movie file to Firebase Storage
    const uploadTask = storageRef.put(file, metadata);

    // Listen for state changes, errors, and completion of the upload
    uploadTask.on(
        'state_changed',
        updateUploadProgress,
        (error) => {
            console.error('Error uploading movie:', error);
            alert('An error occurred while uploading the movie.');
        },
        () => {
            console.log('Movie uploaded successfully.');
            const uploadProgress = document.getElementById('uploadProgress');
            uploadProgress.innerText = '';

            // Get the download URL for the uploaded movie
            storageRef.getDownloadURL().then((url) => {
                // Save the movie URL, captions, and description to Firebase Realtime Database
                const moviesRef = database.ref('movies');
                const newMovieRef = moviesRef.push();
                newMovieRef.set({
                    url: url,
                    captions: captionInput.value || '', // Captions (or an empty string if none provided)
                    description: descriptionInput.value || '', // Description (or an empty string if none provided)
                });

                alert('Movie uploaded successfully.');
            });
        }
    );
}


function searchCaptions() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const movieList = document.getElementById('movieList');

    // Fetch movies from the Firebase Realtime Database
    const moviesRef = database.ref('movies');
    moviesRef.once('value', snapshot => {
        movieList.innerHTML = '';
        snapshot.forEach(movieSnapshot => {
            const movie = movieSnapshot.val();
            const captions = movie.captions || '';

            // Check if the captions contain the search input
            if (captions.toLowerCase().includes(searchInput)) {
                const movieId = movieSnapshot.key;
                const videoContainer = document.createElement('div');
                videoContainer.classList.add('video-card');
                const movieElement = document.createElement('video');
                movieElement.src = movie.url;
                movieElement.controls = true;
                videoContainer.appendChild(movieElement);

                // Create div to display like count
                const likeCount = document.createElement('div');
                likeCount.classList.add('like-count');
                likeCount.innerText = 'Likes: 0'; // Initialize with 0 likes

                // Create div to display captions
                const captionText = document.createElement('div');
                captionText.classList.add('caption-text');
                captionText.innerText = `Captions: ${captions || 'No captions available'}`;

                // Create like button
                const likeButton = document.createElement('button');
                likeButton.classList.add('like-button');
                likeButton.innerText = 'Like';

                // Event listener for like button
                likeButton.addEventListener('click', () => {
                    if (currentUser) {
                        // Check if the user has already liked this movie
                        const userLikesRef = database.ref(`users/${currentUser.uid}/likes`);
                        userLikesRef.once('value', userLikesSnapshot => {
                            if (!userLikesSnapshot.hasChild(movieId)) {
                                // User has not liked this movie, allow them to like it
                                const movieLikesRef = database.ref(`movies/${movieId}/likes`);
                                movieLikesRef.transaction(currentLikes => {
                                    // If no likes exist, start with 1 like; otherwise, increment by 1
                                    return (currentLikes || 0) + 1;
                                }).then(() => {
                                    // Update the displayed like count
                                    movieLikesRef.once('value', snapshot => {
                                        const updatedLikes = snapshot.val();
                                        likeCount.innerText = `Likes: ${updatedLikes}`;
                                    });

                                    // Record the user's like in the user's likes list
                                    userLikesRef.child(movieId).set(true);
                                });
                            }
                        });
                    } else {
                        // User is not authenticated, handle accordingly (e.g., show a message or prompt for login)
                        alert('Please log in to like the movie.');
                    }
                });

                videoContainer.appendChild(likeCount);
                videoContainer.appendChild(captionText);
                videoContainer.appendChild(likeButton);
                movieList.appendChild(videoContainer);

                // Fetch and display the initial like count from the database
                const movieLikesRef = database.ref(`movies/${movieId}/likes`);
                movieLikesRef.on('value', snapshot => {
                    const updatedLikes = snapshot.val();
                    likeCount.innerText = `Likes: ${updatedLikes}`;
                });
            }
        });
    });
}


// Function to filter and display movies based on genre
function filterMovies(genre) {
    const movieList = document.getElementById('movieList');

    // Fetch movies from the Firebase Realtime Database
    const moviesRef = database.ref('movies');
    moviesRef.once('value', snapshot => {
        movieList.innerHTML = '';
        snapshot.forEach(movieSnapshot => {
            const movie = movieSnapshot.val();
            const captions = movie.captions || '';

            // Check if the captions contain the genre keyword
            if (captions.toLowerCase().includes(genre.toLowerCase())) {
                const movieId = movieSnapshot.key;
                const videoContainer = document.createElement('div');
                videoContainer.classList.add('video-card');
                const movieElement = document.createElement('video');
                movieElement.src = movie.url;
                movieElement.controls = true;
                videoContainer.appendChild(movieElement);

                // Create div to display like count
                const likeCount = document.createElement('div');
                likeCount.classList.add('like-count');
                likeCount.innerText = 'Likes: 0'; // Initialize with 0 likes

                // Create div to display captions
                const captionText = document.createElement('div');
                captionText.classList.add('caption-text');
                captionText.innerText = `Captions: ${captions || 'No captions available'}`;

                // Create like button
                const likeButton = document.createElement('button');
                likeButton.classList.add('like-button');
                likeButton.innerText = 'Like';

                // Event listener for like button
                likeButton.addEventListener('click', () => {
                    // ... (your existing like button logic) ...
                });

                videoContainer.appendChild(likeCount);
                videoContainer.appendChild(captionText);
                videoContainer.appendChild(likeButton);
                movieList.appendChild(videoContainer);

                // Fetch and display the initial like count from the database
                const movieLikesRef = database.ref(`movies/${movieId}/likes`);
                movieLikesRef.on('value', snapshot => {
                    const updatedLikes = snapshot.val();
                    likeCount.innerText = `Likes: ${updatedLikes}`;
                });
            }
        });
    });
}

    
    </script>
</body>
</html>